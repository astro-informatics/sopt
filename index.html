<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SOPT: Sparse OPTimisation Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SOPT
   </div>
   <div id="projectbrief">Sparse OPTimisation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sparse OPTimisation Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_sopt_sopt_cpp_docs_README"></a> <a href="https://github.com/astro-informatics/sopt/actions/workflows/cmake.yml?query=branch%3Adevelopment+"><img src="https://github.com/astro-informatics/sopt/actions/workflows/cmake.yml/badge.svg?branch=development" alt="build" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/gh/astro-informatics/sopt"><img src="https://codecov.io/gh/astro-informatics/sopt/branch/development/graph/badge.svg" alt="codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://doi.org/10.5281/zenodo.2584256"><img src="http://img.shields.io/badge/DOI-10.5281/zenodo.2584256-blue.svg?style=flat" alt="DOI" style="pointer-events: none;" class="inline"/></a></p>
<h1>Description</h1>
<p><b>SOPT</b> is an open-source <code>C++</code> package available under the <a href="#license">license</a> below. It performs Sparse OPTimisation using state-of-the-art convex optimisation algorithms. It solves a variety of sparse regularisation problems, including the Sparsity Averaging Reweighted Analysis (SARA) algorithm.</p>
<p><b>SOPT</b> also has several MPI wrappers that can be adapted for computational distirbution of various linear operators and convex optimisation algorithms. Wavelet Operators with <b>SOPT</b> also support multi-threading through OpenMP.</p>
<p><b>SOPT</b> is written in <code>C++</code> primarily but also contains partial and prototyped Matlab implementations of various algorithms.</p>
<p><b>SOPT</b> is largely provided to support the <a href="https://github.com/astro-informatics/purify"><b>PURIFY</b></a> package, a companion open-source code to perform radio interferometric imaging, also written by the authors of <b>SOPT</b>. For further background please see the <a href="#references-and-citation">reference</a> section.</p>
<p>This documentation outlines the necessary and optional <a href="#dependencies-installation">dependencies</a> upon which <b>SOPT</b> should be built, before describing <a href="#installing-and-building-SOPT">installation</a> and <a href="#testing">testing</a> details and <a href="#Matlab">Matlab</a> support. <a href="#contributors">Contributors</a>, <a href="#references-and-citation">references</a> and <a href="#license">license</a> information then follows.</p>
<h1>Dependencies installation</h1>
<p><b>SOPT</b> is mostly written in <code>C++17</code>. Pre-requisites and dependencies are listed in following and minimal versions required are tested against <code>Travis CI</code> meaning that they come natively with OSX and the Ubuntu Trusty release. These are also the default ones fetched by <code>CMake</code>.</p>
<p><code>C++</code> minimal dependencies:</p>
<ul>
<li><a href="http://www.cmake.org/">CMake</a> v3.9.2 A free software that allows cross-platform compilation.</li>
<li><a href="https://gcc.gnu.org">GCC</a> v7.3.0 GNU compiler for <code>C++</code>.</li>
<li><a href="http://openmp.org/wp/">OpenMP</a> v4.8.4 (Trusty) - Optional - Speeds up some of the operations.</li>
<li><a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen3</a> v3.4.0 (Trusty) Modern <code>C++</code> linear algebra. Downloaded automatically if absent.</li>
<li><a href="https://github.com/catchorg/Catch2">Catch2</a> v3.4.0 - Optional - A <code>C++</code> unit-testing framework only needed for testing.</li>
<li><a href="https://github.com/google/benchmark">google/benchmark</a> - Optional - A <code>C++</code> micro-benchmarking framework only needed for benchmarks.</li>
<li><a href="http://www.libtiff.org/">tiff</a> v4.5.1 (Trusty) Tag Image File Format library - only installed if needed.</li>
<li><a href="https://onnxruntime.ai/">ONNXruntime</a> v1.17.1 - Optional - a cross-platform runtime engine based on the Open Neural Network eXchange format.</li>
</ul>
<h1>Installing and building SOPT</h1>
<p>If the dependencies are already available on your system, you can install <b>SOPT</b> manually like so</p>
<div class="fragment"><div class="line">cd /path/to/code</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=${PWD}/../local</div>
<div class="line">make -j</div>
<div class="line">make -j install</div>
</div><!-- fragment --><p>On MacOS, you can also install most of the dependencies with Homebrew e.g.</p>
<div class="fragment"><div class="line">brew install libtensorflow eigen tiff catch2</div>
</div><!-- fragment --><p> <b>Note that on MacOS, the ONNXruntime currently only support Clang but not g++</b></p>
<h1>Testing</h1>
<p>To check everything went all right, run the test suite:</p>
<div class="fragment"><div class="line">cd /path/to/code/build</div>
<div class="line">ctest .</div>
</div><!-- fragment --><h1>Debugging the CI workflow with tmate</h1>
<p>The CI workflow has a manual dispatch trigger which allows you to log into the job while it's running. You can trigger it in <a href="https://github.com/astro-informatics/sopt/actions/workflows/cmake.yml">actions</a>. Run the workflow and set <code>debug_enabled=true</code> to enable the <code>tmate</code> step in the CI workflow. Once the workflow is running, open the job in actions. You should see it printing out a line with a <code>ssh</code> command. Run it in terminal to log into the GitHub Actions runner.</p>
<h1>Machine-learning models</h1>
<p>Machine-learning models are supported via the ONNXruntime interface. Nearly all modern ML toolkits allow to export their trained models into the ONNXruntime format using Python.</p>
<p>Install translation packages e.g. using <code>pip</code>: </p><div class="fragment"><div class="line">pip install onnx</div>
<div class="line">pip install onnxscript</div>
</div><!-- fragment --><p>PyTorch models can be exported to ONNXruntime like so </p><div class="fragment"><div class="line">import torch</div>
<div class="line">torch_model = ... # PyTorch model based on torch.nn</div>
<div class="line">torch_input = torch_input = torch.randn(256, 256) # model input tensor</div>
<div class="line">torch.onnx.export(torch_model,</div>
<div class="line">                  torch_init,</div>
<div class="line">                  &#39;model_name.onnx&#39;,        # output file name</div>
<div class="line">                  export_params=True,       # store trained param weights</div>
<div class="line">                  opset_version=11,         # ONNX version to export the model to</div>
<div class="line">                  do_constant_folding=True, # optmise using pre-computed constant nodes</div>
<div class="line">                  input_names=[&#39;input&#39;],</div>
<div class="line">                  output_names=[&#39;ouput&#39;],</div>
<div class="line">                  dynamic_axes={&#39;input&#39;  : {0 : &#39;batch_size&#39;},</div>
<div class="line">                                &#39;output&#39; : {0 : &#39;batch_size&#39;}})</div>
</div><!-- fragment --><p>Tensorflow models can be exported to ONNXruntime like so </p><div class="fragment"><div class="line">python -m tf2onnx.convert</div>
<div class="line">       --saved-model model_name.pb</div>
<div class="line">       --output model_name.onnx</div>
<div class="line">       --opset 11</div>
<div class="line">       --inputs input0:0</div>
<div class="line">       --extra_opset StatefulPartitionedCall:0</div>
</div><!-- fragment --><p>After the export, load the model and verify that it's well formed like so </p><div class="fragment"><div class="line">import onnx</div>
<div class="line">onnx_model = onnx.load(&quot;model_name.onnx&quot;)</div>
<div class="line">onnx.checker.check_model(onnx_model)</div>
<div class="line">print( onnx_model.graph.input )</div>
</div><!-- fragment --><p> Hard-coded dimensions can be removed from the input/output tensor e.g. like so </p><div class="fragment"><div class="line">print (onnx_model.graph.input[0].type.tensor_type.shape)</div>
<div class="line">onnx_model.graph.input[0].type.tensor_type.shape.dim[1].ClearField(&#39;dim_value&#39;)</div>
</div><!-- fragment --><p><a href="https://netron.app/">Netron</a> is a useful online tool to help visualise the model.</p>
<h1>Matlab</h1>
<p>A separate Matlab implementation is provided with <b>SOPT</b>. This implementation includes some (but not all) of the optimisation algorithms implemented in the <code>C++</code> code, including the SARA algorithm.</p>
<p>The Matlab implementation is contained in the matlab directory. This is a stand-alone implementation and does not call any of the <code>C++</code> code. In future, Matlab interfaces to the <code>C++</code> code may also be included in <b>SOPT</b>.</p>
<p>See <code>matlab/README.txt</code> for an overview of the Matlab implementation. The stand-alone Matlab implementation is also self-documenting; corresponding documentation can be found in <code>matlab/doc</code>. We thank Gilles Puy for contributing to this Matlab implementation.</p>
<h1>Contributors</h1>
<p>Check the <a class="el" href="sopt_contributors.html">contributors</a> page (<a class="el" href="SOPT__CONTRIBUTORS_8md.html">github</a>).</p>
<h1>References and citation</h1>
<p>If you use <b>SOPT</b> for work that results in publication, please reference the <a href="#webpage">webpage</a> and our related academic papers:</p>
<ol type="1">
<li>L. Pratley <em>et al.</em> (to be published)</li>
<li>A. Onose, R. E. Carrillo, A. Repetti, J. D. McEwen, J.-P. Thiran, J.-C. Pesquet, and Y. Wiaux. "Scalable splitting algorithms for big-data interferometric imaging in the SKA era" <em>Mon. Not. Roy. Astron. Soc.</em> <b>462(4):4314-4335</b> (2016) <a href="http://arxiv.org/abs/arXiv:1601.04026">arXiv:1601.04026</a></li>
<li>R. E. Carrillo, J. D. McEwen, D. Van De Ville, J.-P. Thiran, and Y. Wiaux. "Sparsity averaging
   for compressive imaging" <em>IEEE Signal Processing Letters</em> <b>20(6):591-594</b> (2013) <a href="http://arxiv.org/abs/arXiv:1208.2330">arXiv:1208.2330</a></li>
<li>R. E. Carrillo, J. D. McEwen and Y. Wiaux. "Sparsity Averaging Reweighted
   Analysis (SARA): a novel algorithm for radio-interferometric imaging" <em>Mon. Not. Roy. Astron. Soc.</em> <b>426(2):1223-1234</b> (2012) <a href="http://arxiv.org/abs/arXiv:1205.3123">arXiv:1205.3123</a></li>
</ol>
<h1>License</h1>
<blockquote class="doxtable">
<p>SOPT: Sparse OPTimisation package Copyright (C) 2013-2024</p>
<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details (LICENSE.txt).</p>
<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. </p>
</blockquote>
<h1>Webpage</h1>
<ul>
<li><a href="http://astro-informatics.github.io/sopt">Documentation</a></li>
<li><a href="https://github.com/astro-informatics/sopt">Repository</a></li>
</ul>
<h1>Support</h1>
<p>For any questions or comments, feel free to contact <a href="http://www.jasonmcewen.org">Jason McEwen</a>, or add an issue to the <a href="https://github.com/astro-informatics/sopt/issues">issue tracker</a>.</p>
<h1>Notes</h1>
<p>The code is given for educational purpose. For the <code>Matlab</code> version of the code see the folder matlab. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
